{"code":"!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,o){\n/*\n* @module uniSoc\n* @author plundell\n* @license Apache-2.0\n* @description Frontend component of uniSoc. Wraps around native WebSocket API (https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)\n* @extends ./unisoc-common.js   \n* @depends libbetter\n* @exports n/a      This script should be bundled and loaded in the browser directly. It make the module available \n*                   available at window.uniSoc. If you want to require the web-component of uniSoc @see ./unisoc-web.js\n*/\nif(!window)throw new Error(\"Could not access the 'window'. Cannot load uniSoc.\");o(1);Object.defineProperty(window,\"uniSoc\",{enumerable:!0,configurable:!0,get:()=>{if(window.BetterLog&&window.BetterEvents&&window.BetterUtil)return window.uniSoc=proto(window);throw new Error(\"E_DEPENDENCY. uniSoc depends on libbetter which should be set on the window.\")},set:e=>(Object.defineProperty(window,\"uniSoc\",{value:e,enumerable:!0,writable:!0,configurable:!0}),e)})},function(e,t,o){\n/*\n* @module uniSoc\n* @author plundell\n* @license Apache-2.0\n* @description Frontend component of uniSoc. Wraps around native WebSocket API (https://developer.mozilla.org/en-US/docs/Web/API/WebSocket)\n*\n* @extends ./unisoc-common.js \t\n* @depends libbetter\n*\n* This script can be required by another script or bundled and loaded in the browser directly, making\n* it available at window.uniSoc\n*\n*/\ne.exports=function(e={}){o(!function(){var e=new Error(\"Cannot find module './unisoc-common.js'\");throw e.code=\"MODULE_NOT_FOUND\",e}())(e);const t=e.BetterUtil;function n(e){uniSoc.Websocket.call(this,Object.assign({},n.defaultOptions,e));this.on(\"_connect\",()=>this.log.info(\"CONNECTED\"))}return n.defaultOptions={reconnectTimeout:5e3},n.prototype=Object.create(uniSoc.Websocket.prototype),Object.defineProperty(n.prototype,\"constructor\",{value:n}),n.prototype.connect=function(e,o){try{this.connected&&this.log.makeError(\"Already connected\").throw(\"EALREADY\"),o=\"reconnect\"==o,e&&Object.assign(this._options,e);var n=\"//\"+(this._options.host?this._options.host:document.location.host);this._options.port&&(n+=\":\"+this._options.port),n=(\"https:\"==document.location.protocol?\"wss:\":\"ws:\")+n,o||this.log.info(\"Attempting to connect to websocket:\",n).exec(),this.socket=new WebSocket(n,\"json\"),this.registerAllListeners();var{promise:r,resolve:c,reject:i,inspect:s}=t.exposedPromise(5e3);this.once(\"_connect\",c),this.once(\"_disconnect\",i);var u=(new Error).stack;return r.then(()=>{this.off(\"_disconnect\",i),this.once(\"_disconnect\",()=>this.reconnect())},e=>{this.off(\"_connect\",c);let t=this.log.makeError(e,this.socket).setStack(u);if(this.socket=null,!o)return t.reject();t.prepend(\"Reconnect failed.\"),1006==t.code?(t.changeLvl(\"debug\").printed=!0,t.exec()):t.exec(),this.reconnect()})}catch(e){let t=this.log.makeError(e).prepend(\"BUGBUG:\");if(!o)return t.reject();t.exec()}},n.prototype.reconnect=function(e){e&&\"number\"==typeof e&&(this._options.reconnectTimeout=e),(e=this._options.reconnectTimeout)?(this.log.trace(`Trying to reconnect in ${e} ms.`),setTimeout(()=>this.connect(null,\"reconnect\"),e)):this.log.note(\"Not reconnecting. See this._options.reconnectTimeout\")},n.prototype.abortReconnect=function(){this._options.reconnectTimeout=null},n}}]);","extractedComments":[]}